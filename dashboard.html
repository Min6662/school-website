<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - School Management System</title>
    <link rel="stylesheet" href="css/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-graduation-cap"></i> School Portal</h3>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item active">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="students.html" class="nav-item">
                <i class="fas fa-user-graduate"></i>
                <span>Students</span>
            </a>
            <a href="teachers.html" class="nav-item">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>Teachers</span>
            </a>
            <a href="classes.html" class="nav-item">
                <i class="fas fa-book-open"></i>
                <span>Classes</span>
            </a>
            <a href="results.html" class="nav-item">
                <i class="fas fa-chart-bar"></i>
                <span>Results</span>
            </a>
            <a href="settings.html" class="nav-item">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
    </div>

    <div class="main-content">
        <header class="main-header">
            <h1>Dashboard</h1>
            <div class="header-actions">
                <button class="btn btn-outline" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </header>

        <div class="content-wrapper">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chalkboard-teacher"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-teachers">11</h3>
                        <p>Total Teachers</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-students">62</h3>
                        <p>Total Students</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-classes">12</h3>
                        <p>Total Classes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="present-today">7</h3>
                        <p>Present Today</p>
                    </div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <div class="dashboard-main">
                    <!-- Quick Actions -->
                    <div class="action-cards">
                        <div class="action-card" onclick="window.location.href='students.html'">
                            <div class="action-card-header">
                                <h3><i class="fas fa-user-plus"></i> Add Student</h3>
                            </div>
                            <div class="action-card-body">
                                <p>Register new students to the system</p>
                            </div>
                            <div class="action-card-footer">
                                <button class="btn btn-primary">Get Started</button>
                            </div>
                        </div>
                        <div class="action-card" onclick="window.location.href='teachers.html'">
                            <div class="action-card-header">
                                <h3><i class="fas fa-user-tie"></i> Add Teacher</h3>
                            </div>
                            <div class="action-card-body">
                                <p>Add new teaching staff members</p>
                            </div>
                            <div class="action-card-footer">
                                <button class="btn btn-primary">Get Started</button>
                            </div>
                        </div>
                        <div class="action-card" onclick="window.location.href='classes.html'">
                            <div class="action-card-header">
                                <h3><i class="fas fa-book"></i> Manage Classes</h3>
                            </div>
                            <div class="action-card-body">
                                <p>Create and organize class schedules</p>
                            </div>
                            <div class="action-card-footer">
                                <button class="btn btn-primary">Get Started</button>
                            </div>
                        </div>
                        <div class="action-card" onclick="window.location.href='results.html'">
                            <div class="action-card-header">
                                <h3><i class="fas fa-chart-bar"></i> View Results</h3>
                            </div>
                            <div class="action-card-body">
                                <p>Check academic performance and grades</p>
                            </div>
                            <div class="action-card-footer">
                                <button class="btn btn-primary">Get Started</button>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="recent-activity">
                        <h3>Recent Activity</h3>
                        <div class="activity-list">
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">New student enrolled</div>
                                    <div class="activity-time">2 hours ago</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Grade report generated</div>
                                    <div class="activity-time">4 hours ago</div>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <i class="fas fa-calendar"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">Class schedule updated</div>
                                    <div class="activity-time">1 day ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-sidebar">
                    <!-- Calendar Widget -->
                    <div class="calendar-widget">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button onclick="navigateMonth(-1)">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <h3 class="calendar-month">October, 2025</h3>
                                <button onclick="navigateMonth(1)">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="calendar-body">
                            <div class="calendar-weekdays">
                                <div class="calendar-weekday">Sun</div>
                                <div class="calendar-weekday">Mon</div>
                                <div class="calendar-weekday">Tue</div>
                                <div class="calendar-weekday">Wed</div>
                                <div class="calendar-weekday">Thu</div>
                                <div class="calendar-weekday">Fri</div>
                                <div class="calendar-weekday">Sat</div>
                            </div>
                            <div class="calendar-days" id="calendar-days">
                                <!-- Calendar days will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Chart -->
                    <div class="attendance-chart">
                        <div class="chart-header">
                            <h3>Attendance Overview</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="attendance-pie-chart" width="200" height="200"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color present"></div>
                                <span>Present (87.5%)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color absent"></div>
                                <span>Absent (12.5%)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h3>Quick Actions</h3>
                        <div class="quick-action-list">
                            <a href="students.html" class="quick-action-item">
                                <div class="quick-action-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="quick-action-content">
                                    <div class="quick-action-title">View All Students</div>
                                    <div class="quick-action-desc">Manage student records</div>
                                </div>
                            </a>
                            <a href="teachers.html" class="quick-action-item">
                                <div class="quick-action-icon">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                                <div class="quick-action-content">
                                    <div class="quick-action-title">Teacher Management</div>
                                    <div class="quick-action-desc">Manage teaching staff</div>
                                </div>
                            </a>
                            <a href="results.html" class="quick-action-item">
                                <div class="quick-action-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="quick-action-content">
                                    <div class="quick-action-title">Academic Reports</div>
                                    <div class="quick-action-desc">View performance data</div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/api-service.js"></script>
    <script src="js/student-management.js"></script>
    
    <script>
        // Check authentication before initializing
        function checkAuthentication() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            console.log('🔍 Checking authentication, isLoggedIn:', isLoggedIn);
            
            if (isLoggedIn !== 'true') {
                console.log('❌ Not authenticated, redirecting to login');
                // For testing, let's temporarily allow access
                // Uncomment the next line to enforce authentication
                // window.location.href = 'login.html';
                console.log('⚠️ Authentication bypassed for testing');
                return true; // Temporarily allow access
            }
            console.log('✅ User is authenticated');
            return true;
        }

        // Dashboard Manager
        class DashboardManager {
            constructor(apiService) {
                this.apiService = apiService;
                this.init();
            }

            async init() {
                try {
                    await this.loadStatistics();
                    this.initializeCalendar();
                    this.initializeChart();
                    console.log('✅ Dashboard initialized');
                } catch (error) {
                    console.error('❌ Dashboard initialization failed:', error);
                }
            }

            async loadStatistics() {
                try {
                    console.log('📊 Loading statistics...');
                    
                    // Check if API service is available
                    if (!this.apiService) {
                        console.warn('⚠️ API service not available, using default values');
                        return;
                    }
                    
                    // Load real data from API
                    const [teachers, students, classes] = await Promise.all([
                        this.apiService.getTeachers(),
                        this.apiService.getStudents(), 
                        this.apiService.getClasses()
                    ]);

                    console.log('✅ Statistics loaded:', {
                        teachers: teachers.length,
                        students: students.length,
                        classes: classes.length
                    });

                    document.getElementById('total-teachers').textContent = teachers.length;
                    document.getElementById('total-students').textContent = students.length;
                    document.getElementById('total-classes').textContent = classes.length;
                } catch (error) {
                    console.error('❌ Failed to load statistics:', error);
                    // Keep default values if API fails
                }
            }

            initializeCalendar() {
                // Calendar initialization code would go here
                console.log('Calendar initialized');
            }

            initializeChart() {
                // Chart initialization code would go here  
                console.log('Chart initialized');
            }
        }

        // Navigation functions
        function navigateMonth(direction) {
            console.log('Navigate month:', direction);
        }

        // Initialize dashboard when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuthentication()) return;
            
            if (typeof apiService !== 'undefined') {
                window.dashboardManager = new DashboardManager(apiService);
            } else {
                console.error('API service not available');
            }
        });
    </script>
</body>
</html>